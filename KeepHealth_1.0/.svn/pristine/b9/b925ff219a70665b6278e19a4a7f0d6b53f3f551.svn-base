/**下午3:34:42
 * @author zhangyh2
 * WXQShareListener.java
 * TODO
 */
package com.umeng.share;

import android.content.Context;
import android.util.Log;

import com.umeng.MainShareListener;
import com.umeng.socialize.controller.UMServiceFactory;
import com.umeng.socialize.controller.UMSocialService;
import com.umeng.socialize.media.UMImage;
import com.umeng.socialize.weixin.controller.UMWXHandler;
import com.umeng.socialize.weixin.media.CircleShareContent;
import com.umeng.socialize.weixin.media.WeiXinShareContent;
import com.ytdinfo.keephealth.app.Constants;
import com.ytdinfo.keephealth.app.MyApp;
import com.ytdinfo.keephealth.wxapi.CustomShareBoard;
import com.ytdinfo.keephealth.wxapi.WXCallBack;

/**
 * @author zhangyh2 WXQShareListener 下午3:34:42 TODO
 *         微社区分享在这里实现。原理为Lib中编写接口和单例帮助类，
 *         在主程序中进行初始化，并进行接口实现，传递实现的接口实例，然后在Lib中的事件中进行触发，回调起这个类里面的函数内容
 */
public class WXQShareListener implements MainShareListener, WXCallBack {
	public static WXQShareListener sInstance;

	public static WXQShareListener getInstance() {
		if (sInstance == null) {
			sInstance = new WXQShareListener();
		}
		return sInstance;
	}

	private UMSocialService mController = UMServiceFactory
			.getUMSocialService(Constants.DESCRIPTOR);

	public CustomShareBoard shareBoard;

	private void addWXPlatform() {

		shareBoard.setWXCallBack(this);
		// 注意：在微信授权的时候，必须传递appSecret
		// wx967daebe835fbeac是你在微信开发平台注册应用的AppID, 这里需要替换成你注册的AppID
		String appId = "wxe9dfaf997a35d828";
		String appSecret = "e98b52d02f8112bcc93181490b980aab";
		// 添加微信平台
		UMWXHandler wxHandler = new UMWXHandler(MyApp.getInstance(), appId,
				appSecret);
		wxHandler.addToSocialSDK();

		// 支持微信朋友圈
		UMWXHandler wxCircleHandler = new UMWXHandler(MyApp.getInstance(),
				appId, appSecret);
		wxCircleHandler.setToCircle(true);
		wxCircleHandler.addToSocialSDK();
	}

	/*
	 * (non-Javadoc)
	 * 
	 * @see com.umeng.MainShareListener#shared(java.lang.String,
	 * java.lang.String, java.lang.String, java.lang.String)
	 */
	@Override
	public void shared(Context context, String titleName, String thumbUrl,
			String url, String siteDesc) {
		// TODO Auto-generated method stub
		shareBoard = new CustomShareBoard(context);
		addWXPlatform();
		Log.i("setShareContent", titleName + "======" + siteDesc + "======="
				+ url + "========" + thumbUrl);
		// 微信分享
		WeiXinShareContent weixinContent = new WeiXinShareContent();
		weixinContent.setShareContent(siteDesc);
		weixinContent.setTitle(titleName);
		weixinContent.setTargetUrl(url);
		UMImage urlImage = new UMImage(MyApp.getInstance(), thumbUrl);
		weixinContent.setShareMedia(urlImage);
		mController.setShareMedia(weixinContent);

		// 设置微信圈分享的内容
		CircleShareContent circleMedia = new CircleShareContent();
		circleMedia.setShareContent(siteDesc);
		circleMedia.setTitle(titleName);
		circleMedia.setTargetUrl(url);
		circleMedia.setShareMedia(urlImage);
		mController.setShareMedia(circleMedia);
	}

	/*
	 * (non-Javadoc)
	 * 
	 * @see com.ytdinfo.keephealth.wxapi.WXCallBack#shareComplete(boolean)
	 */
	@Override
	public void shareComplete(boolean flag) {
		// TODO Auto-generated method stub

	}

}
